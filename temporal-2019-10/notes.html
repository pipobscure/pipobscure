<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Temporal - Update 2019-10-01 - Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="http://fonts.googleapis.com/css?family=Playball" rel="stylesheet">
  <link href="/assets/css/jekyllthemes.css" rel="stylesheet" />
  <link href="/assets/css/syntax.css" rel="stylesheet" />
</head>


<body>



  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-735643-13', 'jekyllthemes.org');
    ga('send', 'pageview');
  </script>



  <header id="header">
    <div class="wrap">

      <h1 id="logo"><a href="/"></a></h1>

    </div>
  </header>



  <div id="pagecontainer" class="container">



    <!--<div class="hero-unit">
      <p><strong>Need a design for your <a href="http://jekyllrb.com/">Jekyll</a> blog?</strong> Whether you're looking for a fresh theme to drop in and go, or to use as a starting point for customization, you'll find the best ones available right here.</p>
    </div>-->



    <div class="widebanner row">
      <div class="span12">
        <div class="banner72" id="banner72">

          <script type="text/javascript"><!--

            var width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;

            google_ad_client = "ca-pub-7611360452853908";

            if (width > 769) {
              google_ad_slot = "6552835850";
              google_ad_width = 728;
              google_ad_height = 90;
            } else {
              var el = document.getElementById("banner72");
              el.parentNode.removeChild(el);
            }

            //-->
          </script>
          <script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>

        </div>
      </div>
    </div>



    <div id="content">


        <h1 id="temporal---update-2019-10-01---notes">Temporal - Update 2019-10-01 - Notes</h1>

<h2 id="zonedabsolute-vs-zoneddatetime">ZonedAbsolute vs. ZonedDateTime</h2>

<p>If we were to go with a ZonedAbsolute where we combine an <code class="language-plaintext highlighter-rouge">Absolute</code> with a <code class="language-plaintext highlighter-rouge">TimeZone</code> this would become an issue:</p>

<p>(@apaprocki)</p>

<blockquote>
  <p>The 2019 Brazil transition looks like this now post-tzdata2019c:</p>

  <blockquote>
    <p>new Temporal.Absolute(1572577199000000000n).withZone(‘America/Sao_Paulo’).toString()</p>
  </blockquote>

  <p>‘2019-10-31T23:59:59-03:00[America/Sao_Paulo]’</p>

  <blockquote>
    <p>new Temporal.Absolute(1572577200000000000n).withZone(‘America/Sao_Paulo’).toString()</p>
  </blockquote>

  <p>‘2019-11-01T00:00:00-03:00[America/Sao_Paulo]’</p>

  <p><em>Prior</em> to tzdata2019c being applied, it would have looked like this:</p>

  <blockquote>
    <p>new Temporal.Absolute(1572577199000000000n).withZone(‘America/Sao_Paulo’).toString()</p>
  </blockquote>

  <p>‘2019-10-31T23:59:59-03:00[America/Sao_Paulo]’</p>

  <blockquote>
    <p>new Temporal.Absolute(1572577200000000000n).withZone(‘America/Sao_Paulo’).toString()</p>
  </blockquote>

  <p>‘2019-11-01T01:00:00-02:00[America/Sao_Paulo]’</p>

  <p>I have a critical job that needs to run at 1am <em>local time</em> in Sao Paulo on November 1st no matter what.
The future job was created using a local datetime of “2019-11-01T01:00:00” because that was the user intention.
The future job was entered on 2019-01-01, however, prior to the release/adoption of tzdata 2019c, where the future definition of America/Sao_Paulo changed.</p>

  <p>If any system (e.g. Temporal) resolves my intention (1am in local time) to an absolute instant at the time of entry, it would have computed an epoch of 1572577200000000000n + America/Sao_Paulo and that is how the job would be recorded.</p>

  <p>Later in 2019, the system gets patched with tzdata 2019c and the system restarts, and queued jobs are read.</p>

  <p>The epoch 1572577200000000000n is read and used to create a time in America/Sao_Paulo.</p>

  <p>Now, because the definition of local time has changed, the system will run the job at midnight on November 1st instead of the intended time of 1am.</p>

  <p>Future datetimes must be kept in local civil datetime + timezone and continuously rendered to UTC / absolute instant to ensure that if the definition of timezones change, the intention of the user (the local civil datetime) is not lost.</p>
</blockquote>

<p>So based on that we’d want to have a <code class="language-plaintext highlighter-rouge">ZonedDateTime</code> combination rather than a <code class="language-plaintext highlighter-rouge">ZonedAbsolute</code>. However this goes directly against what we’ve been doing so far.</p>

<p>We’ve rather cavalierly combined these concepts and just met with absolute chaos, because the object takse on a duality that makes things unexpected.</p>

<p>The alternative then becomes to do both a <code class="language-plaintext highlighter-rouge">ZonedAbsolute</code> and a <code class="language-plaintext highlighter-rouge">ZonedDateTime</code>, but I think this doesn’t help the cause, since picking the right thing for the job requires a thoughtful decision. This is easier to do if there is no provided <code class="language-plaintext highlighter-rouge">class</code> to do this, but rather an explicit programming choice in which primitives to use.</p>



    </div>


  </div>



  <footer id="footer">
    <div class="container">
      <div class="row">

        <div class="span5 copyright">
          Copyright &copy; 2020 Matt Harzewski. Powered by <a href="http://jekyllrb.com">Jekyll</a>.
          <br /><br />
          <iframe src="http://ghbtns.com/github-btn.html?user=mattvh&repo=jekyllthemes&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
          <iframe src="http://ghbtns.com/github-btn.html?user=mattvh&repo=jekyllthemes&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
          <br /><br />
        </div>

        <div class="span7">
          <h3>Want to Submit a Theme?</h3>
          <ul>
            <li>Fork <a href="https://github.com/mattvh/jekyllthemes" target="_blank">our site</a> on GitHub</li>
            <li>Create a new post in the <code>_posts</code> directory and fill out the relevant YAML fields</li>
            <li>Make a 250x200 thumbnail and drop it in the <code>thumbnails</code> directory. List its filename in the post's markdown file.</li>
            <li>Test it out, then push your changes up and open a pull request.</li>
          </ul>
        </div>

      </div>
    </div>
  </footer>



</body>
</html>
